{% extends "base.html" %}
{% block extra_head_content  %}
	{% load static %}
	<link rel="stylesheet" type="text/css" href="{% static 'css/account.css' %}" />
{% endblock %}
{% block js %}
<script src="../../../static/js/Chart.js"></script> 
<script src="../../../static/js/Colors.js"></script> 
{% endblock %}

{% block title_h1 %} Accueil {% endblock %}
{% block principal_section %}
<article>
<h3> Dépense {{year}} </h3>
<div class="width_all">
	<canvas id="linechart" height="200" width=600"></canvas>
	<canvas id="barchart" height="200" width=600"></canvas>
</div>
</article>

<article class="piechart">
<h3> Moyenne à l'année </h3>
<div class="width_half">
	<canvas id="piechart1" height="100" width="100"></canvas>
</div>
</article>

<article class="piechart">
<h3> Moyenne du mois </h3>
<div class="width_half">
	<canvas id="piechart2" height="100" width="100"></canvas>
</div>
</article>

<script>
(function(){
	// Definition couleurs
	var $id = function(id){
		return document.getElementById(id);
	    };

	// paramètre graphique en ligne
	var lineData = {
	labels : ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Aout", "Septembre", "Octobre", "Novembre", "Décembre"],
	datasets : [
		{
		label: "Gain",
		fillColor: veryLightColors["gain"],
		strokeColor: lightColors["gain"],
		pointColor: colors["gain"],
		pointStrokeColor: "#fff",
		pointHighlightFill: "#fff",
		pointHighlightStroke: "rgba(220,220,220,1)",
		data: [{{total_by_month.gain.0}}, {{total_by_month.gain.1}}, {{total_by_month.gain.2}}, {{total_by_month.gain.3}}, {{total_by_month.gain.4}}, {{total_by_month.gain.5}}, {{total_by_month.gain.6}}, {{total_by_month.gain.7}}, {{total_by_month.gain.8}}, {{total_by_month.gain.9}}, {{total_by_month.gain.10}}, {{total_by_month.gain.11}}]
		},
		{
		label: "Depense",
		fillColor: veryLightColors["all"],
		strokeColor: lightColors["all"],
		pointColor: colors["all"],
		pointStrokeColor: "#fff",
		pointHighlightFill: "#fff",
		pointHighlightStroke: "rgba(220,220,220,1)",
		data: [{{total_by_month.all.0}}, {{total_by_month.all.1}}, {{total_by_month.all.2}}, {{total_by_month.all.3}}, {{total_by_month.all.4}}, {{total_by_month.all.5}}, {{total_by_month.all.6}}, {{total_by_month.all.7}}, {{total_by_month.all.8}}, {{total_by_month.all.9}}, {{total_by_month.all.10}}, {{total_by_month.all.11}}]
		}
	]
};

	var ctx1 = document.getElementById("linechart").getContext("2d");
	myLine = new Chart(ctx1).Line(lineData, {
			responsive: true, scaleShowGridLines : true
	})

	// paramètre graphique en bar
	var barData = {
	labels : ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Aout", "Septembre", "Octobre", "Novembre", "Décembre"],
	datasets : [
		{
		label: "Necessaire",
		fillColor: colors["necessaire"],
		strokeColor: lightColors["necessaire"],
		highlightFill: lightColors["necessaire"],
		highlightStroke: veryLightColors["necessaire"],
		data: [{{total_by_month.necessaire.0}}, {{total_by_month.necessaire.1}}, {{total_by_month.necessaire.2}}, {{total_by_month.necessaire.3}}, {{total_by_month.necessaire.4}}, {{total_by_month.necessaire.5}}, {{total_by_month.necessaire.6}}, {{total_by_month.necessaire.7}}, {{total_by_month.necessaire.8}}, {{total_by_month.necessaire.9}}, {{total_by_month.necessaire.10}}, {{total_by_month.necessaire.11}}]
		},
		{
		label: "Achat",
		fillColor: colors["achat"],
		strokeColor: lightColors["achat"],
		highlightFill: lightColors["achat"],
		highlightStroke: colors["achat"],
		data: [{{total_by_month.achat.0}}, {{total_by_month.achat.1}}, {{total_by_month.achat.2}}, {{total_by_month.achat.3}}, {{total_by_month.achat.4}}, {{total_by_month.achat.5}}, {{total_by_month.achat.6}}, {{total_by_month.achat.7}}, {{total_by_month.achat.8}}, {{total_by_month.achat.9}}, {{total_by_month.achat.10}}, {{total_by_month.achat.11}}]
		},
		{
		label: "Sortie",
		fillColor: colors["sortie"],
		strokeColor: lightColors["sortie"],
		highlightFill: lightColors["sortie"],
		highlightStroke: veryLightColors["sortie"],
		data: [{{total_by_month.sortie.0}}, {{total_by_month.sortie.1}}, {{total_by_month.sortie.2}}, {{total_by_month.sortie.3}}, {{total_by_month.sortie.4}}, {{total_by_month.sortie.5}}, {{total_by_month.sortie.6}}, {{total_by_month.sortie.7}}, {{total_by_month.sortie.8}}, {{total_by_month.sortie.9}}, {{total_by_month.sortie.10}}, {{total_by_month.sortie.11}}]
		},
		{
		label: "Vacances",
		fillColor: colors["vacances"],
		strokeColor: lightColors["vacances"],
		highlightFill: lightColors["vacances"],
		highlightStroke: veryLightColors["vacances"],
		data: [{{total_by_month.vacances.0}}, {{total_by_month.vacances.1}}, {{total_by_month.vacances.2}}, {{total_by_month.vacances.3}}, {{total_by_month.vacances.4}}, {{total_by_month.vacances.5}}, {{total_by_month.vacances.6}}, {{total_by_month.vacances.7}}, {{total_by_month.vacances.8}}, {{total_by_month.vacances.9}}, {{total_by_month.vacances.10}}, {{total_by_month.vacances.11}}]
		},
		{
		label: "Autre",
		fillColor: colors["autre"],
		strokeColor: lightColors["autre"],
		highlightFill: lightColors["autre"],
		highlightStroke: veryLightColors["autre"],
		data: [{{total_by_month.autre.0}}, {{total_by_month.autre.1}}, {{total_by_month.autre.2}}, {{total_by_month.autre.3}}, {{total_by_month.autre.4}}, {{total_by_month.autre.5}}, {{total_by_month.autre.6}}, {{total_by_month.autre.7}}, {{total_by_month.autre.8}}, {{total_by_month.autre.9}}, {{total_by_month.autre.10}}, {{total_by_month.autre.11}}]
		}
	]
};

	var ctx2 = document.getElementById("barchart").getContext("2d");
	myBar = new Chart(ctx2).Bar(barData, {
			responsive: true, scaleShowGridLines : true
	})

	// Definitions camemberts
	var canvas_pie1 = $id('piechart1'),
	    canvas_pie2 = $id('piechart2'),
	    legendPie1 = $id('pielegend1'),
	    legendPie2 = $id('pielegend2'),
	    helpers = Chart.helpers;

	var pieDataYear = [
    		{
        	value: {{average.necessaire}},
		color: colors["necessaire"],
	        highlight: lightColors["necessaire"],
	        label: "Necessaire"
		},
		{
		value: {{average.achat}},
		color: colors["achat"],
	        highlight: lightColors["achat"],
	        label: "Achat"
		},
		{
	        value: {{average.sortie}},
		color: colors["sortie"],
	        highlight: lightColors["sortie"],
	        label: "Sortie"
		},
		{
	        value: {{average.vacances}},
		color: colors["vacances"],
	        highlight: lightColors["vacances"],
	        label: "Vacances"
		},
		{
	        value: {{average.autre}},
		color: colors["autre"],
	        highlight: lightColors["autre"],
	        label: "Autre"
		}
	];

	var pieDataMonth = [
    		{
        	value: {{month_average.necessaire}},
		color: colors["necessaire"],
	        highlight: lightColors["necessaire"],
	        label: "Necessaire"
		},
		{
		value: {{month_average.achat}},
		color: colors["achat"],
	        highlight: lightColors["achat"],
	        label: "Achat"
		},
		{
	        value: {{month_average.sortie}},
		color: colors["sortie"],
	        highlight: lightColors["sortie"],
	        label: "Sortie"
		},
		{
	        value: {{month_average.vacances}},
		color: colors["vacances"],
	        highlight: lightColors["vacances"],
	        label: "Vacances"
		},
		{
	        value: {{month_average.autre}},
		color: colors["autre"],
	        highlight: lightColors["autre"],
	        label: "Autre"
		}
	];

	pieOptions = { 
		segmentStrokeColor: "#ebe8e4",
		tooltipTemplate: "<\%if (label){\%><\%=label\%>: <\%}\%><\%= value \%>€"
	};

	
	var myPie1 = new Chart(canvas_pie1.getContext('2d')).Pie(pieDataYear, pieOptions);
	var legendHolder1 = document.createElement('div');
	legendHolder1.innerHTML = myPie1.generateLegend();
	// Include a html legend template after the module doughnut itself
	helpers.each(legendHolder1.firstChild.childNodes, function(legendNode, index){
		helpers.addEvent(legendNode, 'mouseover', function(){
			var activeSegment = myPie1.segments[index];
			activeSegment.save();
			activeSegment.fillColor = activeSegment.highlightColor;
			myPie1.showTooltip([activeSegment]);
			activeSegment.restore();
		});
	});
	helpers.addEvent(legendHolder1.firstChild, 'mouseout', function(){
		myPie1.draw();
	});
	canvas_pie1.parentNode.parentNode.appendChild(legendHolder1.firstChild);

	var myPie2 = new Chart(canvas_pie2.getContext('2d')).Pie(pieDataMonth, pieOptions);
	var legendHolder2 = document.createElement('div');
	legendHolder2.innerHTML = myPie2.generateLegend();
	// Include a html legend template after the module doughnut itself
	helpers.each(legendHolder2.firstChild.childNodes, function(legendNode, index){
		helpers.addEvent(legendNode, 'mouseover', function(){
			var activeSegment = myPie2.segments[index];
			activeSegment.save();
			activeSegment.fillColor = activeSegment.highlightColor;
			myPie2.showTooltip([activeSegment]);
			activeSegment.restore();
		});
	});
	helpers.addEvent(legendHolder2.firstChild, 'mouseout', function(){
		myPie2.draw();
	});
	canvas_pie2.parentNode.parentNode.appendChild(legendHolder2.firstChild);

})();

</script>
{% endblock %}
